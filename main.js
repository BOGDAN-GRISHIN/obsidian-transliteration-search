/*
THIS IS A GENERATED/BUNDLED FILE BY ROLLUP
if you want to view the source visit the plugins github repository
*/

'use strict';

var obsidian = require('obsidian');

/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */

function __awaiter(thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
}

/**
 * Use as compareFn in sort
 */
const sorter = (toOrdered, order = "asc") => {
    return (a, b) => order === "asc"
        ? toOrdered(a) > toOrdered(b)
            ? 1
            : toOrdered(b) > toOrdered(a)
                ? -1
                : 0
        : toOrdered(a) < toOrdered(b)
            ? 1
            : toOrdered(b) < toOrdered(a)
                ? -1
                : 0;
};
const keyBy = (values, toKey) => values.reduce((prev, cur, _1, _2, k = toKey(cur)) => ((prev[k] = cur), prev), {});

const FOLDER = `<svg viewBox="0 0 100 100" class="folder" width="17" height="17"><path fill="currentColor" stroke="currentColor" d="M6.1,8c-3.3,0-6,2.7-6,6v73.8c-0.1,0.5-0.1,0.9,0.1,1.4c0.6,2.7,3,4.8,5.9,4.8h78c3,0,5.4-2.2,5.9-5.1 c0-0.1,0.1-0.2,0.1-0.4c0,0,0-0.1,0-0.1l0.1-0.3c0,0,0,0,0-0.1l9.9-53.6l0.1-0.2V34c0-3.3-2.7-6-6-6v-6c0-3.3-2.7-6-6-6H36.1 c0,0,0,0-0.1,0c-0.1,0-0.2-0.2-0.6-0.6c-0.5-0.6-1.1-1.5-1.7-2.5c-0.6-1-1.3-2.1-2.1-3C30.9,9,29.7,8,28.1,8L6.1,8z M6.1,12h22 c-0.1,0,0.1,0,0.6,0.6c0.5,0.6,1.1,1.5,1.7,2.5c0.6,1,1.3,2.1,2.1,3c0.8,0.9,1.9,1.9,3.6,1.9h52c1.1,0,2,0.9,2,2v6h-74 c-3.1,0-5.7,2.5-5.9,5.6h-0.1L10.1,34l-6,32.4V14C4.1,12.9,4.9,12,6.1,12z M16.1,32h78c1.1,0,2,0.9,2,2l-9.8,53.1l-0.1,0.1 c0,0.1,0,0.2-0.1,0.2c0,0.1,0,0.2-0.1,0.2c0,0,0,0.1,0,0.1c0,0,0,0,0,0.1c0,0.1,0,0.2-0.1,0.3c0,0.1,0,0.1,0,0.2 c0,0.1,0,0.2,0,0.2c-0.3,0.8-1,1.4-1.9,1.4h-78c-1.1,0-2-0.9-2-2L14,34.4l0.1-0.2V34C14.1,32.9,14.9,32,16.1,32L16.1,32z"></path></svg>`;
const ALIAS = `<svg viewBox="0 0 100 100" class="forward-arrow" width="16" height="16"><path fill="currentColor" stroke="currentColor" d="m9.9,89.09226c-0.03094,0 -0.05414,0 -0.08508,0c-1.06734,-0.04641 -1.91039,-0.92812 -1.89492,-1.99547c0.00774,-0.48726 1.14469,-48.13101 47.52,-49.44586l0,-13.89094c0,-0.7657 0.44086,-1.4618 1.12922,-1.78664c0.68062,-0.33258 1.5082,-0.23203 2.09601,0.2475l31.68,25.74c0.46406,0.37899 0.73476,0.9436 0.73476,1.53914c0,0.59555 -0.2707,1.16016 -0.72703,1.53914l-31.68,25.74c-0.59555,0.47953 -1.41539,0.57234 -2.10375,0.2475c-0.68836,-0.32485 -1.12922,-1.02094 -1.12922,-1.78664l0,-13.84453c-41.26289,0.75024 -43.49039,24.81961 -43.56773,25.85601c-0.06961,1.04414 -0.93586,1.84078 -1.97226,1.84078z"></path></svg>`;

const regEmoji = new RegExp(/[\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF]/, "g");
function excludeEmoji(text) {
    return text.replace(regEmoji, "");
}
function excludeSpace(text) {
    return text.replace(/ /g, "");
}
function smartIncludes(text, query) {
    return excludeSpace(text.toLowerCase()).includes(query.toLowerCase());
}
function smartStartsWith(text, query) {
    return excludeSpace(excludeEmoji(text.toLowerCase())).startsWith(query.toLowerCase());
}
function stampMatchType(item, queries) {
    if (queries.every((q) => smartStartsWith(item.file.name, q))) {
        return Object.assign(Object.assign({}, item), { matchType: "prefix-name" });
    }
    if (queries.every((q) => smartIncludes(item.file.name, q))) {
        return Object.assign(Object.assign({}, item), { matchType: "name" });
    }
    if (queries.every((q) => smartIncludes(item.file.path, q))) {
        return Object.assign(Object.assign({}, item), { matchType: "directory" });
    }
    if (queries.every((q) => {
        var _a;
        return ((_a = obsidian.parseFrontMatterAliases(item.cache.frontmatter)) !== null && _a !== void 0 ? _a : []).some((al) => smartIncludes(al, q));
    })) {
        return Object.assign(Object.assign({}, item), { matchType: "alias" });
    }
    return item;
}
function toPrefixIconHTML(item) {
    switch (item.item.matchType) {
        case "alias":
            return `<span class="another-quick-switcher__item__icon">${ALIAS}</span>`;
        case "directory":
            return `<span class="another-quick-switcher__item__icon">${FOLDER}</span>`;
    }
    return "";
}
class SmartSearchModal extends obsidian.FuzzySuggestModal {
    constructor(app) {
        super(app);
        this.scope.register(["Ctrl"], "Enter", 
        // XXX: This is unsafe code..!! ðŸ˜‚
        this.scope.keys.find((x) => !x.modifiers && x.key === "Enter").func);
    }
    getSuggestions(query) {
        if (!query) {
            const fileByPath = keyBy(this.getItems(), (x) => x.file.path);
            return this.app.workspace.getLastOpenFiles().map((x) => {
                const s = fileByPath[x];
                return {
                    item: s,
                    match: { score: 0, matches: [] },
                };
            });
        }
        let lastOpenFileIndexByPath = {};
        this.app.workspace.getLastOpenFiles().forEach((v, i) => {
            lastOpenFileIndexByPath[v] = i;
        });
        const recentMode = query.startsWith("/");
        const qs = (recentMode ? query.slice(1) : query)
            .split(" ")
            .filter((x) => x);
        let items = this.getItems()
            .map((x) => stampMatchType(x, qs))
            .filter((x) => x.matchType)
            .sort(sorter((x) => x.file.stat.mtime, "desc"))
            .sort(sorter((x) => { var _a; return (_a = lastOpenFileIndexByPath[x.file.path]) !== null && _a !== void 0 ? _a : 65535; }))
            .map((x) => ({
            item: x,
            match: {
                score: 0,
                matches: [],
            },
        }));
        if (!recentMode) {
            items = items
                .sort(sorter((x) => (x.item.matchType === "directory" ? 1 : 0)))
                .sort(sorter((x) => x.item.matchType === "prefix-name"
                ? 1000 - x.item.file.name.length
                : 0, "desc"));
        }
        return items.slice(0, 10);
    }
    renderSuggestion(item, el) {
        const suggestionItemHtml = `
<div class="another-quick-switcher__item">
  <div class="another-quick-switcher__item__file">${item.item.file.basename}</div>
  <div class="another-quick-switcher__item__directory">${FOLDER} ${item.item.file.parent.name}</div>
</div>
`.trim();
        el.insertAdjacentHTML("beforeend", `${toPrefixIconHTML(item)}${suggestionItemHtml}`);
    }
    getItemText(item) {
        return `${item.file.basename}`;
    }
    getItems() {
        return this.app.vault.getMarkdownFiles().map((x) => ({
            file: x,
            cache: this.app.metadataCache.getFileCache(x),
        }));
    }
    onChooseItem(item, evt) {
        // For Ctrl + Click, not Ctrl + Enter (TODO...)
        this.openFile(item.file, evt.ctrlKey);
    }
    openFile(file, newLeaf) {
        const leaf = this.app.workspace.getLeaf(newLeaf);
        leaf.openFile(file).then(() => {
            this.app.workspace.setActiveLeaf(leaf, true, newLeaf);
        });
    }
}

class SmartSearch extends obsidian.Plugin {
    onload() {
        return __awaiter(this, void 0, void 0, function* () {
            console.log("loading plugin");
            this.addCommand({
                id: "search",
                name: "Search",
                hotkeys: [{ modifiers: ["Ctrl"], key: "p" }],
                checkCallback: (checking) => {
                    if (!checking) {
                        this.showList();
                    }
                    return true;
                },
            });
        });
    }
    showList() {
        const modal = new SmartSearchModal(this.app);
        modal.open();
    }
}

module.exports = SmartSearch;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsibm9kZV9tb2R1bGVzL3RzbGliL3RzbGliLmVzNi5qcyIsImNvbGxlY3Rpb24taGVscGVyLnRzIiwidWkvaWNvbnMudHMiLCJ1aS9TbWFydFNlYXJjaE1vZGFsLnRzIiwibWFpbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiEgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uXHJcblxyXG5QZXJtaXNzaW9uIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBhbmQvb3IgZGlzdHJpYnV0ZSB0aGlzIHNvZnR3YXJlIGZvciBhbnlcclxucHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLlxyXG5cclxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiBBTkQgVEhFIEFVVEhPUiBESVNDTEFJTVMgQUxMIFdBUlJBTlRJRVMgV0lUSFxyXG5SRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFlcclxuQU5EIEZJVE5FU1MuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkUgTElBQkxFIEZPUiBBTlkgU1BFQ0lBTCwgRElSRUNULFxyXG5JTkRJUkVDVCwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTIFdIQVRTT0VWRVIgUkVTVUxUSU5HIEZST01cclxuTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1JcclxuT1RIRVIgVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUlxyXG5QRVJGT1JNQU5DRSBPRiBUSElTIFNPRlRXQVJFLlxyXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqL1xyXG4vKiBnbG9iYWwgUmVmbGVjdCwgUHJvbWlzZSAqL1xyXG5cclxudmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbihkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2V4dGVuZHMoZCwgYikge1xyXG4gICAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcclxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhiKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XHJcbiAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbn1cclxuXHJcbmV4cG9ydCB2YXIgX19hc3NpZ24gPSBmdW5jdGlvbigpIHtcclxuICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiBfX2Fzc2lnbih0KSB7XHJcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XHJcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkgdFtwXSA9IHNbcF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3Jlc3QocywgZSkge1xyXG4gICAgdmFyIHQgPSB7fTtcclxuICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSAmJiBlLmluZGV4T2YocCkgPCAwKVxyXG4gICAgICAgIHRbcF0gPSBzW3BdO1xyXG4gICAgaWYgKHMgIT0gbnVsbCAmJiB0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyA9PT0gXCJmdW5jdGlvblwiKVxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBwID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzKTsgaSA8IHAubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKGUuaW5kZXhPZihwW2ldKSA8IDAgJiYgT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHMsIHBbaV0pKVxyXG4gICAgICAgICAgICAgICAgdFtwW2ldXSA9IHNbcFtpXV07XHJcbiAgICAgICAgfVxyXG4gICAgcmV0dXJuIHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2RlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XHJcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcclxuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XHJcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19wYXJhbShwYXJhbUluZGV4LCBkZWNvcmF0b3IpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBrZXkpIHsgZGVjb3JhdG9yKHRhcmdldCwga2V5LCBwYXJhbUluZGV4KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSkge1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0Lm1ldGFkYXRhID09PSBcImZ1bmN0aW9uXCIpIHJldHVybiBSZWZsZWN0Lm1ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXRlcih0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2dlbmVyYXRvcih0aGlzQXJnLCBib2R5KSB7XHJcbiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnO1xyXG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHtcclxuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XHJcbiAgICAgICAgd2hpbGUgKF8pIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbXCJyZXR1cm5cIl0gOiBvcFswXSA/IHlbXCJ0aHJvd1wiXSB8fCAoKHQgPSB5W1wicmV0dXJuXCJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDtcclxuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTtcclxuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cclxuICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHZhciBfX2NyZWF0ZUJpbmRpbmcgPSBPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XHJcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xyXG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xyXG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcclxuICAgIG9bazJdID0gbVtrXTtcclxufSk7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHBvcnRTdGFyKG0sIG8pIHtcclxuICAgIGZvciAodmFyIHAgaW4gbSkgaWYgKHAgIT09IFwiZGVmYXVsdFwiICYmICFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobywgcCkpIF9fY3JlYXRlQmluZGluZyhvLCBtLCBwKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fdmFsdWVzKG8pIHtcclxuICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7XHJcbiAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTtcclxuICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gXCJudW1iZXJcIikgcmV0dXJuIHtcclxuICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gXCJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLlwiIDogXCJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19yZWFkKG8sIG4pIHtcclxuICAgIHZhciBtID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXTtcclxuICAgIGlmICghbSkgcmV0dXJuIG87XHJcbiAgICB2YXIgaSA9IG0uY2FsbChvKSwgciwgYXIgPSBbXSwgZTtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgd2hpbGUgKChuID09PSB2b2lkIDAgfHwgbi0tID4gMCkgJiYgIShyID0gaS5uZXh0KCkpLmRvbmUpIGFyLnB1c2goci52YWx1ZSk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZXJyb3IpIHsgZSA9IHsgZXJyb3I6IGVycm9yIH07IH1cclxuICAgIGZpbmFsbHkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChyICYmICFyLmRvbmUgJiYgKG0gPSBpW1wicmV0dXJuXCJdKSkgbS5jYWxsKGkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmaW5hbGx5IHsgaWYgKGUpIHRocm93IGUuZXJyb3I7IH1cclxuICAgIH1cclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuLyoqIEBkZXByZWNhdGVkICovXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZCgpIHtcclxuICAgIGZvciAodmFyIGFyID0gW10sIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgIGFyID0gYXIuY29uY2F0KF9fcmVhZChhcmd1bWVudHNbaV0pKTtcclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuLyoqIEBkZXByZWNhdGVkICovXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZEFycmF5cygpIHtcclxuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xyXG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxyXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxyXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcclxuICAgIHJldHVybiByO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWRBcnJheSh0bywgZnJvbSwgcGFjaykge1xyXG4gICAgaWYgKHBhY2sgfHwgYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgZm9yICh2YXIgaSA9IDAsIGwgPSBmcm9tLmxlbmd0aCwgYXI7IGkgPCBsOyBpKyspIHtcclxuICAgICAgICBpZiAoYXIgfHwgIShpIGluIGZyb20pKSB7XHJcbiAgICAgICAgICAgIGlmICghYXIpIGFyID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSwgMCwgaSk7XHJcbiAgICAgICAgICAgIGFyW2ldID0gZnJvbVtpXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdG8uY29uY2F0KGFyIHx8IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20pKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXQodikge1xyXG4gICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBfX2F3YWl0ID8gKHRoaXMudiA9IHYsIHRoaXMpIDogbmV3IF9fYXdhaXQodik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jR2VuZXJhdG9yKHRoaXNBcmcsIF9hcmd1bWVudHMsIGdlbmVyYXRvcikge1xyXG4gICAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxuICAgIHZhciBnID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pLCBpLCBxID0gW107XHJcbiAgICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgaWYgKGdbbl0pIGlbbl0gPSBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGEsIGIpIHsgcS5wdXNoKFtuLCB2LCBhLCBiXSkgPiAxIHx8IHJlc3VtZShuLCB2KTsgfSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHJlc3VtZShuLCB2KSB7IHRyeSB7IHN0ZXAoZ1tuXSh2KSk7IH0gY2F0Y2ggKGUpIHsgc2V0dGxlKHFbMF1bM10sIGUpOyB9IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAocikgeyByLnZhbHVlIGluc3RhbmNlb2YgX19hd2FpdCA/IFByb21pc2UucmVzb2x2ZShyLnZhbHVlLnYpLnRoZW4oZnVsZmlsbCwgcmVqZWN0KSA6IHNldHRsZShxWzBdWzJdLCByKTsgfVxyXG4gICAgZnVuY3Rpb24gZnVsZmlsbCh2YWx1ZSkgeyByZXN1bWUoXCJuZXh0XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gcmVqZWN0KHZhbHVlKSB7IHJlc3VtZShcInRocm93XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKGYsIHYpIHsgaWYgKGYodiksIHEuc2hpZnQoKSwgcS5sZW5ndGgpIHJlc3VtZShxWzBdWzBdLCBxWzBdWzFdKTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY0RlbGVnYXRvcihvKSB7XHJcbiAgICB2YXIgaSwgcDtcclxuICAgIHJldHVybiBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiwgZnVuY3Rpb24gKGUpIHsgdGhyb3cgZTsgfSksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4sIGYpIHsgaVtuXSA9IG9bbl0gPyBmdW5jdGlvbiAodikgeyByZXR1cm4gKHAgPSAhcCkgPyB7IHZhbHVlOiBfX2F3YWl0KG9bbl0odikpLCBkb25lOiBuID09PSBcInJldHVyblwiIH0gOiBmID8gZih2KSA6IHY7IH0gOiBmOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jVmFsdWVzKG8pIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgbSA9IG9bU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCBpO1xyXG4gICAgcmV0dXJuIG0gPyBtLmNhbGwobykgOiAobyA9IHR5cGVvZiBfX3ZhbHVlcyA9PT0gXCJmdW5jdGlvblwiID8gX192YWx1ZXMobykgOiBvW1N5bWJvbC5pdGVyYXRvcl0oKSwgaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGkpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgZCwgdikgeyBQcm9taXNlLnJlc29sdmUodikudGhlbihmdW5jdGlvbih2KSB7IHJlc29sdmUoeyB2YWx1ZTogdiwgZG9uZTogZCB9KTsgfSwgcmVqZWN0KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tYWtlVGVtcGxhdGVPYmplY3QoY29va2VkLCByYXcpIHtcclxuICAgIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvb2tlZCwgXCJyYXdcIiwgeyB2YWx1ZTogcmF3IH0pOyB9IGVsc2UgeyBjb29rZWQucmF3ID0gcmF3OyB9XHJcbiAgICByZXR1cm4gY29va2VkO1xyXG59O1xyXG5cclxudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9IE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xyXG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcclxuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2ltcG9ydFN0YXIobW9kKSB7XHJcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xyXG4gICAgdmFyIHJlc3VsdCA9IHt9O1xyXG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xyXG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2ltcG9ydERlZmF1bHQobW9kKSB7XHJcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IGRlZmF1bHQ6IG1vZCB9O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZEdldChyZWNlaXZlciwgc3RhdGUsIGtpbmQsIGYpIHtcclxuICAgIGlmIChraW5kID09PSBcImFcIiAmJiAhZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlByaXZhdGUgYWNjZXNzb3Igd2FzIGRlZmluZWQgd2l0aG91dCBhIGdldHRlclwiKTtcclxuICAgIGlmICh0eXBlb2Ygc3RhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHJlY2VpdmVyICE9PSBzdGF0ZSB8fCAhZiA6ICFzdGF0ZS5oYXMocmVjZWl2ZXIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IHJlYWQgcHJpdmF0ZSBtZW1iZXIgZnJvbSBhbiBvYmplY3Qgd2hvc2UgY2xhc3MgZGlkIG5vdCBkZWNsYXJlIGl0XCIpO1xyXG4gICAgcmV0dXJuIGtpbmQgPT09IFwibVwiID8gZiA6IGtpbmQgPT09IFwiYVwiID8gZi5jYWxsKHJlY2VpdmVyKSA6IGYgPyBmLnZhbHVlIDogc3RhdGUuZ2V0KHJlY2VpdmVyKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fY2xhc3NQcml2YXRlRmllbGRTZXQocmVjZWl2ZXIsIHN0YXRlLCB2YWx1ZSwga2luZCwgZikge1xyXG4gICAgaWYgKGtpbmQgPT09IFwibVwiKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBtZXRob2QgaXMgbm90IHdyaXRhYmxlXCIpO1xyXG4gICAgaWYgKGtpbmQgPT09IFwiYVwiICYmICFmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBhY2Nlc3NvciB3YXMgZGVmaW5lZCB3aXRob3V0IGEgc2V0dGVyXCIpO1xyXG4gICAgaWYgKHR5cGVvZiBzdGF0ZSA9PT0gXCJmdW5jdGlvblwiID8gcmVjZWl2ZXIgIT09IHN0YXRlIHx8ICFmIDogIXN0YXRlLmhhcyhyZWNlaXZlcikpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3Qgd3JpdGUgcHJpdmF0ZSBtZW1iZXIgdG8gYW4gb2JqZWN0IHdob3NlIGNsYXNzIGRpZCBub3QgZGVjbGFyZSBpdFwiKTtcclxuICAgIHJldHVybiAoa2luZCA9PT0gXCJhXCIgPyBmLmNhbGwocmVjZWl2ZXIsIHZhbHVlKSA6IGYgPyBmLnZhbHVlID0gdmFsdWUgOiBzdGF0ZS5zZXQocmVjZWl2ZXIsIHZhbHVlKSksIHZhbHVlO1xyXG59XHJcbiIsIi8qKlxuICogVXNlIGFzIGNvbXBhcmVGbiBpbiBzb3J0XG4gKi9cbmV4cG9ydCBjb25zdCBzb3J0ZXIgPSA8VCwgVSBleHRlbmRzIG51bWJlciB8IHN0cmluZz4oXG4gIHRvT3JkZXJlZDogKHQ6IFQpID0+IFUsXG4gIG9yZGVyOiBcImFzY1wiIHwgXCJkZXNjXCIgPSBcImFzY1wiXG4pID0+IHtcbiAgcmV0dXJuIChhOiBULCBiOiBUKSA9PlxuICAgIG9yZGVyID09PSBcImFzY1wiXG4gICAgICA/IHRvT3JkZXJlZChhKSA+IHRvT3JkZXJlZChiKVxuICAgICAgICA/IDFcbiAgICAgICAgOiB0b09yZGVyZWQoYikgPiB0b09yZGVyZWQoYSlcbiAgICAgICAgPyAtMVxuICAgICAgICA6IDBcbiAgICAgIDogdG9PcmRlcmVkKGEpIDwgdG9PcmRlcmVkKGIpXG4gICAgICA/IDFcbiAgICAgIDogdG9PcmRlcmVkKGIpIDwgdG9PcmRlcmVkKGEpXG4gICAgICA/IC0xXG4gICAgICA6IDA7XG59O1xuXG5leHBvcnQgY29uc3QgZ3JvdXBCeSA9IDxUPihcbiAgdmFsdWVzOiBUW10sXG4gIHRvS2V5OiAodDogVCkgPT4gc3RyaW5nXG4pOiB7IFtrZXk6IHN0cmluZ106IFRbXSB9ID0+XG4gIHZhbHVlcy5yZWR1Y2UoXG4gICAgKHByZXYsIGN1ciwgXzEsIF8yLCBrID0gdG9LZXkoY3VyKSkgPT4gKFxuICAgICAgKHByZXZba10gfHwgKHByZXZba10gPSBbXSkpLnB1c2goY3VyKSwgcHJldlxuICAgICksXG4gICAge30gYXMgeyBba2V5OiBzdHJpbmddOiBUW10gfVxuICApO1xuXG5leHBvcnQgY29uc3Qga2V5QnkgPSA8VD4oXG4gIHZhbHVlczogVFtdLFxuICB0b0tleTogKHQ6IFQpID0+IHN0cmluZ1xuKTogeyBba2V5OiBzdHJpbmddOiBUIH0gPT5cbiAgdmFsdWVzLnJlZHVjZShcbiAgICAocHJldiwgY3VyLCBfMSwgXzIsIGsgPSB0b0tleShjdXIpKSA9PiAoKHByZXZba10gPSBjdXIpLCBwcmV2KSxcbiAgICB7fSBhcyB7IFtrZXk6IHN0cmluZ106IFQgfVxuICApO1xuIiwiZXhwb3J0IGNvbnN0IEZPTERFUiA9IGA8c3ZnIHZpZXdCb3g9XCIwIDAgMTAwIDEwMFwiIGNsYXNzPVwiZm9sZGVyXCIgd2lkdGg9XCIxN1wiIGhlaWdodD1cIjE3XCI+PHBhdGggZmlsbD1cImN1cnJlbnRDb2xvclwiIHN0cm9rZT1cImN1cnJlbnRDb2xvclwiIGQ9XCJNNi4xLDhjLTMuMywwLTYsMi43LTYsNnY3My44Yy0wLjEsMC41LTAuMSwwLjksMC4xLDEuNGMwLjYsMi43LDMsNC44LDUuOSw0LjhoNzhjMywwLDUuNC0yLjIsNS45LTUuMSBjMC0wLjEsMC4xLTAuMiwwLjEtMC40YzAsMCwwLTAuMSwwLTAuMWwwLjEtMC4zYzAsMCwwLDAsMC0wLjFsOS45LTUzLjZsMC4xLTAuMlYzNGMwLTMuMy0yLjctNi02LTZ2LTZjMC0zLjMtMi43LTYtNi02SDM2LjEgYzAsMCwwLDAtMC4xLDBjLTAuMSwwLTAuMi0wLjItMC42LTAuNmMtMC41LTAuNi0xLjEtMS41LTEuNy0yLjVjLTAuNi0xLTEuMy0yLjEtMi4xLTNDMzAuOSw5LDI5LjcsOCwyOC4xLDhMNi4xLDh6IE02LjEsMTJoMjIgYy0wLjEsMCwwLjEsMCwwLjYsMC42YzAuNSwwLjYsMS4xLDEuNSwxLjcsMi41YzAuNiwxLDEuMywyLjEsMi4xLDNjMC44LDAuOSwxLjksMS45LDMuNiwxLjloNTJjMS4xLDAsMiwwLjksMiwydjZoLTc0IGMtMy4xLDAtNS43LDIuNS01LjksNS42aC0wLjFMMTAuMSwzNGwtNiwzMi40VjE0QzQuMSwxMi45LDQuOSwxMiw2LjEsMTJ6IE0xNi4xLDMyaDc4YzEuMSwwLDIsMC45LDIsMmwtOS44LDUzLjFsLTAuMSwwLjEgYzAsMC4xLDAsMC4yLTAuMSwwLjJjMCwwLjEsMCwwLjItMC4xLDAuMmMwLDAsMCwwLjEsMCwwLjFjMCwwLDAsMCwwLDAuMWMwLDAuMSwwLDAuMi0wLjEsMC4zYzAsMC4xLDAsMC4xLDAsMC4yIGMwLDAuMSwwLDAuMiwwLDAuMmMtMC4zLDAuOC0xLDEuNC0xLjksMS40aC03OGMtMS4xLDAtMi0wLjktMi0yTDE0LDM0LjRsMC4xLTAuMlYzNEMxNC4xLDMyLjksMTQuOSwzMiwxNi4xLDMyTDE2LjEsMzJ6XCI+PC9wYXRoPjwvc3ZnPmA7XG5leHBvcnQgY29uc3QgQUxJQVMgPSBgPHN2ZyB2aWV3Qm94PVwiMCAwIDEwMCAxMDBcIiBjbGFzcz1cImZvcndhcmQtYXJyb3dcIiB3aWR0aD1cIjE2XCIgaGVpZ2h0PVwiMTZcIj48cGF0aCBmaWxsPVwiY3VycmVudENvbG9yXCIgc3Ryb2tlPVwiY3VycmVudENvbG9yXCIgZD1cIm05LjksODkuMDkyMjZjLTAuMDMwOTQsMCAtMC4wNTQxNCwwIC0wLjA4NTA4LDBjLTEuMDY3MzQsLTAuMDQ2NDEgLTEuOTEwMzksLTAuOTI4MTIgLTEuODk0OTIsLTEuOTk1NDdjMC4wMDc3NCwtMC40ODcyNiAxLjE0NDY5LC00OC4xMzEwMSA0Ny41MiwtNDkuNDQ1ODZsMCwtMTMuODkwOTRjMCwtMC43NjU3IDAuNDQwODYsLTEuNDYxOCAxLjEyOTIyLC0xLjc4NjY0YzAuNjgwNjIsLTAuMzMyNTggMS41MDgyLC0wLjIzMjAzIDIuMDk2MDEsMC4yNDc1bDMxLjY4LDI1Ljc0YzAuNDY0MDYsMC4zNzg5OSAwLjczNDc2LDAuOTQzNiAwLjczNDc2LDEuNTM5MTRjMCwwLjU5NTU1IC0wLjI3MDcsMS4xNjAxNiAtMC43MjcwMywxLjUzOTE0bC0zMS42OCwyNS43NGMtMC41OTU1NSwwLjQ3OTUzIC0xLjQxNTM5LDAuNTcyMzQgLTIuMTAzNzUsMC4yNDc1Yy0wLjY4ODM2LC0wLjMyNDg1IC0xLjEyOTIyLC0xLjAyMDk0IC0xLjEyOTIyLC0xLjc4NjY0bDAsLTEzLjg0NDUzYy00MS4yNjI4OSwwLjc1MDI0IC00My40OTAzOSwyNC44MTk2MSAtNDMuNTY3NzMsMjUuODU2MDFjLTAuMDY5NjEsMS4wNDQxNCAtMC45MzU4NiwxLjg0MDc4IC0xLjk3MjI2LDEuODQwNzh6XCI+PC9wYXRoPjwvc3ZnPmA7XG4iLCJpbXBvcnQge1xuICBBcHAsXG4gIENhY2hlZE1ldGFkYXRhLFxuICBGdXp6eU1hdGNoLFxuICBGdXp6eVN1Z2dlc3RNb2RhbCxcbiAgcGFyc2VGcm9udE1hdHRlckFsaWFzZXMsXG4gIFRGaWxlLFxufSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IGtleUJ5LCBzb3J0ZXIgfSBmcm9tIFwiLi4vY29sbGVjdGlvbi1oZWxwZXJcIjtcbmltcG9ydCB7IEFMSUFTLCBGT0xERVIgfSBmcm9tIFwiLi9pY29uc1wiO1xuXG5pbnRlcmZhY2UgU3VnZ2VzdGlvbkl0ZW0ge1xuICBmaWxlOiBURmlsZTtcbiAgY2FjaGU/OiBDYWNoZWRNZXRhZGF0YTtcbiAgbWF0Y2hUeXBlPzogXCJuYW1lXCIgfCBcInByZWZpeC1uYW1lXCIgfCBcImRpcmVjdG9yeVwiIHwgXCJhbGlhc1wiO1xufVxuXG5jb25zdCByZWdFbW9qaSA9IG5ldyBSZWdFeHAoXG4gIC9bXFx1MjcwMC1cXHUyN0JGXXxbXFx1RTAwMC1cXHVGOEZGXXxcXHVEODNDW1xcdURDMDAtXFx1REZGRl18XFx1RDgzRFtcXHVEQzAwLVxcdURGRkZdfFtcXHUyMDExLVxcdTI2RkZdfFxcdUQ4M0VbXFx1REQxMC1cXHVEREZGXS8sXG4gIFwiZ1wiXG4pO1xuZnVuY3Rpb24gZXhjbHVkZUVtb2ppKHRleHQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiB0ZXh0LnJlcGxhY2UocmVnRW1vamksIFwiXCIpO1xufVxuZnVuY3Rpb24gZXhjbHVkZVNwYWNlKHRleHQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiB0ZXh0LnJlcGxhY2UoLyAvZywgXCJcIik7XG59XG5cbmZ1bmN0aW9uIHNtYXJ0SW5jbHVkZXModGV4dDogc3RyaW5nLCBxdWVyeTogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiBleGNsdWRlU3BhY2UodGV4dC50b0xvd2VyQ2FzZSgpKS5pbmNsdWRlcyhxdWVyeS50b0xvd2VyQ2FzZSgpKTtcbn1cblxuZnVuY3Rpb24gc21hcnRTdGFydHNXaXRoKHRleHQ6IHN0cmluZywgcXVlcnk6IHN0cmluZyk6IGJvb2xlYW4ge1xuICByZXR1cm4gZXhjbHVkZVNwYWNlKGV4Y2x1ZGVFbW9qaSh0ZXh0LnRvTG93ZXJDYXNlKCkpKS5zdGFydHNXaXRoKFxuICAgIHF1ZXJ5LnRvTG93ZXJDYXNlKClcbiAgKTtcbn1cblxuZnVuY3Rpb24gc3RhbXBNYXRjaFR5cGUoXG4gIGl0ZW06IFN1Z2dlc3Rpb25JdGVtLFxuICBxdWVyaWVzOiBzdHJpbmdbXVxuKTogU3VnZ2VzdGlvbkl0ZW0ge1xuICBpZiAocXVlcmllcy5ldmVyeSgocSkgPT4gc21hcnRTdGFydHNXaXRoKGl0ZW0uZmlsZS5uYW1lLCBxKSkpIHtcbiAgICByZXR1cm4geyAuLi5pdGVtLCBtYXRjaFR5cGU6IFwicHJlZml4LW5hbWVcIiB9O1xuICB9XG5cbiAgaWYgKHF1ZXJpZXMuZXZlcnkoKHEpID0+IHNtYXJ0SW5jbHVkZXMoaXRlbS5maWxlLm5hbWUsIHEpKSkge1xuICAgIHJldHVybiB7IC4uLml0ZW0sIG1hdGNoVHlwZTogXCJuYW1lXCIgfTtcbiAgfVxuXG4gIGlmIChxdWVyaWVzLmV2ZXJ5KChxKSA9PiBzbWFydEluY2x1ZGVzKGl0ZW0uZmlsZS5wYXRoLCBxKSkpIHtcbiAgICByZXR1cm4geyAuLi5pdGVtLCBtYXRjaFR5cGU6IFwiZGlyZWN0b3J5XCIgfTtcbiAgfVxuXG4gIGlmIChcbiAgICBxdWVyaWVzLmV2ZXJ5KChxKSA9PlxuICAgICAgKHBhcnNlRnJvbnRNYXR0ZXJBbGlhc2VzKGl0ZW0uY2FjaGUuZnJvbnRtYXR0ZXIpID8/IFtdKS5zb21lKChhbCkgPT5cbiAgICAgICAgc21hcnRJbmNsdWRlcyhhbCwgcSlcbiAgICAgIClcbiAgICApXG4gICkge1xuICAgIHJldHVybiB7IC4uLml0ZW0sIG1hdGNoVHlwZTogXCJhbGlhc1wiIH07XG4gIH1cblxuICByZXR1cm4gaXRlbTtcbn1cblxuZnVuY3Rpb24gdG9QcmVmaXhJY29uSFRNTChpdGVtOiBGdXp6eU1hdGNoPFN1Z2dlc3Rpb25JdGVtPik6IHN0cmluZyB7XG4gIHN3aXRjaCAoaXRlbS5pdGVtLm1hdGNoVHlwZSkge1xuICAgIGNhc2UgXCJhbGlhc1wiOlxuICAgICAgcmV0dXJuIGA8c3BhbiBjbGFzcz1cImFub3RoZXItcXVpY2stc3dpdGNoZXJfX2l0ZW1fX2ljb25cIj4ke0FMSUFTfTwvc3Bhbj5gO1xuICAgIGNhc2UgXCJkaXJlY3RvcnlcIjpcbiAgICAgIHJldHVybiBgPHNwYW4gY2xhc3M9XCJhbm90aGVyLXF1aWNrLXN3aXRjaGVyX19pdGVtX19pY29uXCI+JHtGT0xERVJ9PC9zcGFuPmA7XG4gIH1cbiAgcmV0dXJuIFwiXCI7XG59XG5cbmV4cG9ydCBjbGFzcyBTbWFydFNlYXJjaE1vZGFsIGV4dGVuZHMgRnV6enlTdWdnZXN0TW9kYWw8U3VnZ2VzdGlvbkl0ZW0+IHtcbiAgY29uc3RydWN0b3IoYXBwOiBBcHApIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMuc2NvcGUucmVnaXN0ZXIoXG4gICAgICBbXCJDdHJsXCJdLFxuICAgICAgXCJFbnRlclwiLFxuICAgICAgLy8gWFhYOiBUaGlzIGlzIHVuc2FmZSBjb2RlLi4hISDwn5iCXG4gICAgICAodGhpcy5zY29wZSBhcyBhbnkpLmtleXMuZmluZChcbiAgICAgICAgKHg6IGFueSkgPT4gIXgubW9kaWZpZXJzICYmIHgua2V5ID09PSBcIkVudGVyXCJcbiAgICAgICkuZnVuY1xuICAgICk7XG4gIH1cblxuICBnZXRTdWdnZXN0aW9ucyhxdWVyeTogc3RyaW5nKTogRnV6enlNYXRjaDxTdWdnZXN0aW9uSXRlbT5bXSB7XG4gICAgaWYgKCFxdWVyeSkge1xuICAgICAgY29uc3QgZmlsZUJ5UGF0aCA9IGtleUJ5KHRoaXMuZ2V0SXRlbXMoKSwgKHgpID0+IHguZmlsZS5wYXRoKTtcbiAgICAgIHJldHVybiB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGFzdE9wZW5GaWxlcygpLm1hcCgoeCkgPT4ge1xuICAgICAgICBjb25zdCBzID0gZmlsZUJ5UGF0aFt4XTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBpdGVtOiBzLFxuICAgICAgICAgIG1hdGNoOiB7IHNjb3JlOiAwLCBtYXRjaGVzOiBbXSB9LFxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgbGV0IGxhc3RPcGVuRmlsZUluZGV4QnlQYXRoOiB7IFtwYXRoOiBzdHJpbmddOiBudW1iZXIgfSA9IHt9O1xuICAgIHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMYXN0T3BlbkZpbGVzKCkuZm9yRWFjaCgodiwgaSkgPT4ge1xuICAgICAgbGFzdE9wZW5GaWxlSW5kZXhCeVBhdGhbdl0gPSBpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgcmVjZW50TW9kZSA9IHF1ZXJ5LnN0YXJ0c1dpdGgoXCIvXCIpO1xuICAgIGNvbnN0IHFzID0gKHJlY2VudE1vZGUgPyBxdWVyeS5zbGljZSgxKSA6IHF1ZXJ5KVxuICAgICAgLnNwbGl0KFwiIFwiKVxuICAgICAgLmZpbHRlcigoeCkgPT4geCk7XG5cbiAgICBsZXQgaXRlbXMgPSB0aGlzLmdldEl0ZW1zKClcbiAgICAgIC5tYXAoKHgpID0+IHN0YW1wTWF0Y2hUeXBlKHgsIHFzKSlcbiAgICAgIC5maWx0ZXIoKHgpID0+IHgubWF0Y2hUeXBlKVxuICAgICAgLnNvcnQoc29ydGVyKCh4KSA9PiB4LmZpbGUuc3RhdC5tdGltZSwgXCJkZXNjXCIpKVxuICAgICAgLnNvcnQoc29ydGVyKCh4KSA9PiBsYXN0T3BlbkZpbGVJbmRleEJ5UGF0aFt4LmZpbGUucGF0aF0gPz8gNjU1MzUpKVxuICAgICAgLm1hcCgoeCkgPT4gKHtcbiAgICAgICAgaXRlbTogeCxcbiAgICAgICAgbWF0Y2g6IHtcbiAgICAgICAgICBzY29yZTogMCxcbiAgICAgICAgICBtYXRjaGVzOiBbXSxcbiAgICAgICAgfSxcbiAgICAgIH0pKTtcblxuICAgIGlmICghcmVjZW50TW9kZSkge1xuICAgICAgaXRlbXMgPSBpdGVtc1xuICAgICAgICAuc29ydChzb3J0ZXIoKHgpID0+ICh4Lml0ZW0ubWF0Y2hUeXBlID09PSBcImRpcmVjdG9yeVwiID8gMSA6IDApKSlcbiAgICAgICAgLnNvcnQoXG4gICAgICAgICAgc29ydGVyKFxuICAgICAgICAgICAgKHgpID0+XG4gICAgICAgICAgICAgIHguaXRlbS5tYXRjaFR5cGUgPT09IFwicHJlZml4LW5hbWVcIlxuICAgICAgICAgICAgICAgID8gMTAwMCAtIHguaXRlbS5maWxlLm5hbWUubGVuZ3RoXG4gICAgICAgICAgICAgICAgOiAwLFxuICAgICAgICAgICAgXCJkZXNjXCJcbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGl0ZW1zLnNsaWNlKDAsIDEwKTtcbiAgfVxuXG4gIHJlbmRlclN1Z2dlc3Rpb24oaXRlbTogRnV6enlNYXRjaDxTdWdnZXN0aW9uSXRlbT4sIGVsOiBIVE1MRWxlbWVudCkge1xuICAgIGNvbnN0IHN1Z2dlc3Rpb25JdGVtSHRtbCA9IGBcbjxkaXYgY2xhc3M9XCJhbm90aGVyLXF1aWNrLXN3aXRjaGVyX19pdGVtXCI+XG4gIDxkaXYgY2xhc3M9XCJhbm90aGVyLXF1aWNrLXN3aXRjaGVyX19pdGVtX19maWxlXCI+JHtpdGVtLml0ZW0uZmlsZS5iYXNlbmFtZX08L2Rpdj5cbiAgPGRpdiBjbGFzcz1cImFub3RoZXItcXVpY2stc3dpdGNoZXJfX2l0ZW1fX2RpcmVjdG9yeVwiPiR7Rk9MREVSfSAke2l0ZW0uaXRlbS5maWxlLnBhcmVudC5uYW1lfTwvZGl2PlxuPC9kaXY+XG5gLnRyaW0oKTtcblxuICAgIGVsLmluc2VydEFkamFjZW50SFRNTChcbiAgICAgIFwiYmVmb3JlZW5kXCIsXG4gICAgICBgJHt0b1ByZWZpeEljb25IVE1MKGl0ZW0pfSR7c3VnZ2VzdGlvbkl0ZW1IdG1sfWBcbiAgICApO1xuICB9XG5cbiAgZ2V0SXRlbVRleHQoaXRlbTogU3VnZ2VzdGlvbkl0ZW0pOiBzdHJpbmcge1xuICAgIHJldHVybiBgJHtpdGVtLmZpbGUuYmFzZW5hbWV9YDtcbiAgfVxuXG4gIGdldEl0ZW1zKCk6IFN1Z2dlc3Rpb25JdGVtW10ge1xuICAgIHJldHVybiB0aGlzLmFwcC52YXVsdC5nZXRNYXJrZG93bkZpbGVzKCkubWFwKCh4KSA9PiAoe1xuICAgICAgZmlsZTogeCxcbiAgICAgIGNhY2hlOiB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZSh4KSxcbiAgICB9KSk7XG4gIH1cblxuICBvbkNob29zZUl0ZW0oaXRlbTogU3VnZ2VzdGlvbkl0ZW0sIGV2dDogTW91c2VFdmVudCB8IEtleWJvYXJkRXZlbnQpOiB2b2lkIHtcbiAgICAvLyBGb3IgQ3RybCArIENsaWNrLCBub3QgQ3RybCArIEVudGVyIChUT0RPLi4uKVxuICAgIHRoaXMub3BlbkZpbGUoaXRlbS5maWxlLCBldnQuY3RybEtleSk7XG4gIH1cblxuICBvcGVuRmlsZShmaWxlOiBURmlsZSwgbmV3TGVhZjogYm9vbGVhbikge1xuICAgIGNvbnN0IGxlYWYgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZihuZXdMZWFmKTtcblxuICAgIGxlYWYub3BlbkZpbGUoZmlsZSkudGhlbigoKSA9PiB7XG4gICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uuc2V0QWN0aXZlTGVhZihsZWFmLCB0cnVlLCBuZXdMZWFmKTtcbiAgICB9KTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgUGx1Z2luIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBTbWFydFNlYXJjaE1vZGFsIH0gZnJvbSBcIi4vdWkvU21hcnRTZWFyY2hNb2RhbFwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTbWFydFNlYXJjaCBleHRlbmRzIFBsdWdpbiB7XG4gIGFzeW5jIG9ubG9hZCgpIHtcbiAgICBjb25zb2xlLmxvZyhcImxvYWRpbmcgcGx1Z2luXCIpO1xuXG4gICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiBcInNlYXJjaFwiLFxuICAgICAgbmFtZTogXCJTZWFyY2hcIixcbiAgICAgIGhvdGtleXM6IFt7IG1vZGlmaWVyczogW1wiQ3RybFwiXSwga2V5OiBcInBcIiB9XSxcbiAgICAgIGNoZWNrQ2FsbGJhY2s6IChjaGVja2luZzogYm9vbGVhbikgPT4ge1xuICAgICAgICBpZiAoIWNoZWNraW5nKSB7XG4gICAgICAgICAgdGhpcy5zaG93TGlzdCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHNob3dMaXN0KCkge1xuICAgIGNvbnN0IG1vZGFsID0gbmV3IFNtYXJ0U2VhcmNoTW9kYWwodGhpcy5hcHApO1xuICAgIG1vZGFsLm9wZW4oKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbInBhcnNlRnJvbnRNYXR0ZXJBbGlhc2VzIiwiRnV6enlTdWdnZXN0TW9kYWwiLCJQbHVnaW4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF1REE7QUFDTyxTQUFTLFNBQVMsQ0FBQyxPQUFPLEVBQUUsVUFBVSxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUU7QUFDN0QsSUFBSSxTQUFTLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxPQUFPLEtBQUssWUFBWSxDQUFDLEdBQUcsS0FBSyxHQUFHLElBQUksQ0FBQyxDQUFDLFVBQVUsT0FBTyxFQUFFLEVBQUUsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUU7QUFDaEgsSUFBSSxPQUFPLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxPQUFPLENBQUMsRUFBRSxVQUFVLE9BQU8sRUFBRSxNQUFNLEVBQUU7QUFDL0QsUUFBUSxTQUFTLFNBQVMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFO0FBQ25HLFFBQVEsU0FBUyxRQUFRLENBQUMsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFF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
